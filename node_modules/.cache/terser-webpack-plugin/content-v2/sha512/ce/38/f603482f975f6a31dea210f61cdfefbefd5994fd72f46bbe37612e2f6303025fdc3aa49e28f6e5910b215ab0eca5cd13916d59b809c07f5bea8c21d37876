{"code":"!function(e){var t={};function s(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var r in e)s.d(i,r,function(t){return e[t]}.bind(null,r));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,\"a\",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p=\"\",s(s.s=0)}([function(e,t,s){var i=s(!function(){var e=new Error(\"Cannot find module './js/core.js'\");throw e.code=\"MODULE_NOT_FOUND\",e}());i.onRuntimeInitialized=function(){i.noExitRuntime=!0,window.LayoutGraph=i.LayoutGraph,window.default_settings=i.default_settings};var r=e=>{try{return new URL(e),!0}catch(e){return!1}};class o extends HTMLElement{constructor(){super(),this._size=void 0,this._face=void 0,this._onclick=void 0}connectedCallback(){console.log(\"vertex connected\")}adoptedCallback(){this.connectedCallback()}disconnectedCallback(){console.log(\"vertex disconnected\")}get size(){return this._size}set size(e){this._size=e,this.setAttribute(\"size\",e)}get face(){return this._face}set face(e){this._face=e,this.setAttribute(\"face\",e)}}HTMLElement;class a extends HTMLElement{constructor(){super(),this._color=void 0,this._strength=void 0,this._source=void 0,this._target=void 0}get source(){return this._source}set source(e){this._source=e,this.setAttribute(\"source\",e)}get target(){return this._target}set target(e){this._target=e,this.setAttribute(\"target\",e)}get color(){return this._color}set color(e){this._color=e,this.setAttribute(\"color\",e)}get strength(){return this._strength}set strength(e){this._strength=e,this.setAttribute(\"strength\",e)}connectedCallback(){console.log(\"edge connected\")}adoptedCallback(){this.connectedCallback()}disconnectedCallback(){console.log(\"edge disconnected\")}}class n extends HTMLElement{constructor(e=\"100px\",t=\"100px\"){super(e,t),this.attachShadow({mode:\"open\"}),this._defaults={vertex:{size:10,face:\"black\"},edge:{color:\"black\",strength:1}}}setSize(e,t){console.log(\"setSize\",e,t),(i=this.shadowRoot.querySelector(\"style.default\"))&&this.shadowRoot.removeChild(i);var s=document.createElement(\"template\");s.innerHTML=`\\n    <style class=\"default\">\\n    :host {\\n      display: block;\\n      width: ${e};\\n      height: ${t};\\n      margin: 0;\\n      padding: 0;\\n      border: 1px dashed black;\\n      resize: both;\\n    }\\n\\n    canvas {\\n      width: ${e};\\n      height: ${t};\\n    }\\n    </style>`;var i=s.content.cloneNode(!0);this.shadowRoot.appendChild(i),this.style.width=e,this.style.height=t,this.canvas&&(this.canvas.style.width=this.canvas.width=e,this.canvas.style.height=this.canvas.height=t),this.shadowRoot.appendChild(i),this.renderer&&this.resizeRenderer(),this.camera&&this.resizeCamera(),this.setAttribute(\"width\",e),this.setAttribute(\"height\",t)}resizeRenderer(){this.renderer.setSize(this.clientWidth,this.clientHeight,!0)}resizeCamera(){this.camera.aspect=this.clientWidth/this.clientHeight,this.camera.updateProjectionMatrix()}setupScene(){this.scene=new THREE.Scene,this.light=new THREE.AmbientLight(4210752,1),this.scene.add(this.light),this.renderer=new THREE.WebGLRenderer({canvas:this.canvas,antialias:!0,alpha:!0}),console.log(\"setupScene\",this.width,this.height),this.setSize(this.width,this.height),this.renderer.setClearAlpha(0),console.log(this.clientWidth,this.clientHeight),this.camera=new THREE.PerspectiveCamera(75,this.clientWidth/this.clientHeight,1,1e3),this.scene.add(this.camera),this.camera.position.set(0,0,-50),this.camera.lookAt(0,0,0),this.camera.updateProjectionMatrix()}setupCore(){}setupControls(){var e=new THREE.OrbitControls(this.camera,this.canvas);this.controls=e,this.controls.update()}test(){this.setupControls();var e=this.renderer,t=this.scene,s=this.camera,i=this.controls,r=function(){requestAnimationFrame(r),i.update(),e.render(t,s)};r()}get width(){return this.getAttribute(\"width\")}set width(e){this.setAttribute(\"width\",e),this.setSize(e,this.height),this.canvas&&this.resizeRenderer(),this.camera&&this.resizeCamera()}get height(){return this.getAttribute(\"height\")}set height(e){this.setAttribute(\"height\",e),this.setSize(this.width,e),this.canvas&&this.resizeRenderer(),this.camera&&this.resizeCamera()}setupChildObserver(){var e=this;this.observer=new MutationObserver((function(t,s){for(var i of t)switch(i.type){case\"childList\":for(var r of i.addedNodes)r instanceof o&&e.processAddVertex(r),r instanceof a&&e.processAddEdge(r);for(var n of i.removedNodes)n instanceof o&&e.processRemoveVertex(n),n instanceof a&&e.processRemoveEdge(n);break;case\"attributes\":i.target instanceof o&&e.updateVertex(i.target,i.attributeName),i.target instanceof a&&e.updateEdge(i.target,i.attributeName)}})),this.observer.observe(this,{attributes:!0,childList:!0,subtree:!0})}setupResizeObserver(){this.ro=new ResizeObserver(e=>{for(var t of e)this.setSize(t.contentRect.width+\"px\",t.contentRect.height+\"px\")}),this.ro.observe(this)}connectedCallback(){this.canvas=document.createElement(\"canvas\"),this.shadowRoot.appendChild(this.canvas),this.setupScene(),this.setupChildObserver(),this.textureLoader=new THREE.TextureLoader,document.addEventListener(\"dblclick\",this.resolve_click.bind(this,\"dblclick\"),!1),document.addEventListener(\"click\",this.resolve_click.bind(this,\"click\"),!1)}resolve_click(e,t){console.log(\"click\",t);var s=new THREE.Raycaster,i=new THREE.Vector2;i.x=(t.clientX-this.canvas.offsetLeft)/this.canvas.width*2-1,i.y=-(t.clientY-this.canvas.offsetTop)/this.canvas.height*2+1,s.setFromCamera(i,this.camera);var r=s.intersectObjects(this.scene.children,!0);if(r.length>0){var o=new Event(e);r[0].object.element.dispatchEvent(o)}else{o=new Event(e);this.dispatchEvent(o)}t.stopPropagation()}adoptedCallback(){this.connectedCallback()}disconnectedCallback(){var e=this.querySelectorAll(\"graph-vertex\"),t=this.querySelectorAll(\"graph-edge\");for(var s of t)s.disconnect();for(var i of e)i.disconnect();this.light.dispose(),this.camera.dispose(),this.renderer.dispose(),this.scene.dispose(),this.observer.disconnect(),this.ro.disconnect()}attributeChangedCallback(e,t,s){switch(e){case\"width\":this.setSize(s,this.height);break;case\"height\":this.setSize(this.width,s)}}set defaults(e){Object.assign(this._defaults,e)}get defaults(){return this._defaults}processAddVertex(e){void 0===e.face&&(e.face=this.defaults.vertex.face),void 0===e.size&&(e.size=this.defaults.vertex.size);var t=new THREE.BoxGeometry(e.size,e.size,e.size);e.texture=this.textureLoader.load(e.face);var s=new THREE.MeshBasicMaterial(r(e.face)?{map:e.texture}:{color:e.face}),i=new THREE.Mesh(t,s);i.position.set(50*Math.random(),50*Math.random(),50*Math.random()),e.cube=i,i.element=e,this.scene.add(i);var o=function(){requestAnimationFrame(o),i.rotation.x+=.01,i.rotation.y+=.01};o()}updateVertex(e,t){switch(t){case\"face\":void 0!==e.texture&&e.texture.dispose(),e.cube.material.dispose(),r(e.face)?(void 0!==e.texture&&(e.texture.dispose(),e.cube.material.dispose()),e.texture=this.textureLoader.load(e.face),e.cube.material=new THREE.MeshBasicMaterial({map:e.texture}),e.cube.material.needsUpdate=!0):e.cube.material=new THREE.MeshBasicMaterial({color:e.face});break;case\"size\":e.cube.geometry.dispose(),e.cube.geometry=new THREE.BoxGeometry(e.size,e.size,e.size),e.cube.geometry.verticesNeedUpdate=!0}}updateEdge(e,t){switch(t){case\"color\":console.log(\"updating color\"),e.line.material.dispose(),e.line.material=new THREE.LineBasicMaterial({color:e.color}),e.line.material.needsUpdate=!0;break;case\"strength\":console.log(\"todo\")}}processRemoveVertex(e){console.log(\"removing edges\");var t=this.querySelectorAll(`graph-edge[source=\"#${e.id}\"]`);for(var s of t)this.removeChild(s);for(var s of t=this.querySelectorAll(`graph-edge[target=\"#${e.id}\"]`))this.removeChild(s);console.log(\"removing vertex\",e.cube),this.scene.remove(e.cube),void 0!==e.texture&&e.texture.dispose(),e.cube.material.dispose(),e.cube.geometry.dispose()}processAddEdge(e){void 0===e.color&&(e.color=this.defaults.edge.color),void 0===e.strength&&(e.strength=this.defaults.edge.strength);var t=new THREE.LineBasicMaterial({color:e.color}),s=new THREE.BufferGeometry,i=this.querySelector(e.source),r=this.querySelector(e.target),o=new Float32Array(6);s.setAttribute(\"position\",new THREE.BufferAttribute(o,3));var a=new THREE.Line(s,t);this.scene.add(a);var n=function(){requestAnimationFrame(n);var e=a.geometry.attributes.position.array,t=0;e[t++]=i.cube.position.x,e[t++]=i.cube.position.y,e[t++]=i.cube.position.z,e[t++]=r.cube.position.x,e[t++]=r.cube.position.y,e[t++]=r.cube.position.z,a.geometry.attributes.position.needsUpdate=!0};n(),e.line=a}processRemoveEdge(e){console.log(\"removing edge\",e.line),this.scene.remove(e.line),e.line.material.dispose(),e.line.geometry.dispose()}}customElements.define(\"graph-vertex\",o),customElements.define(\"graph-edge\",a),customElements.define(\"graph-visualization\",n)}]);","extractedComments":[]}